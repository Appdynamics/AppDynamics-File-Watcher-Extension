FILE WATCHER EXTENSION
======================

Use case
--------

An AppDynamics extension to be used with a stand alone Java machine agent to provide metrics from file and directory monitoring.


Prerequisites
-------------
 
This extension requires a AppDynamics Java Machine Agent installed and running. 

Rebuilding the Project
----------------------
1. Clone the repo FileWatcher-extension from GitHub https://github.com/Appdynamics
3. Run 'mvn clean install' from the cloned FileWatcher-extension directory.
4. The FileWatcher-<version>.zip should get built and found in the 'target' directory.


Installation
------------

1. Unzip contents of WMQMonitor-<version>.zip file and copy to <code><machine-agent-dir>/monitors</code> directory.

2. Edit the config.yaml file.  An example config.yaml file follows these installation instructions.

3. Restart the Machine Agent.

Sample config.yaml
------------------
 
The following is a sample config.yaml file that depicts two different file paths defined. The different fields are explained in the in-line comments. 



		# List of file Paths
		# Wildcards supported for field 'path' : "**" and "*".
			# '**' means anything and everything inside a directories. This is recursive on subdirectories. 
			# '*' means anything present till one level of directory heirarchy
			# The above convention is very similar to ant-style conventions for defining directory tasks. For more info : http://ant.apache.org/manual/dirtasks.html#patterns
		#ignoreHiddenFiles : When true, this will cause all hidden files under this file path to be ignored from metric reporting
		#isDirectoryDetailsRequired : When false, this will cause only directory details to be considered and files to be ignored from metric reporting

		fileToProcess:

		  - displayName: "test1"
		    path: "/Users/deepak.kalra/Documents/appdynamics-docs/**"
		    ignoreHiddenFiles: false
		    isDirectoryDetailsRequired: true

		  - displayName: "test2"
		    path: "/Users/deepak.kalra/*/Documents/test/*"
		    ignoreHiddenFiles: false
		    isDirectoryDetailsRequired: true    


		  - displayName: "test3"
		    path: "/Users/deepak.kalra/Desktop/https___www.myutiitsl.pdf"
		    ignoreHiddenFiles: false
		    isDirectoryDetailsRequired: true   

		# This is the global isDirectoryDetailsRequired flag. When an individual fileToProcess path has this flag missing, this global one will be used.    
		# If false then all the files under the directory will be ignored and only the directory level metrics will be published
		# for the directories specified above.
		# For files given above it will have no effect
		isDirectoryDetailsRequired: false

		# If true then an extra metric will be shown that will give age of the oldest file (in seconds when the file was last
		# modified and compared to current time) in the directory(ies) specified above.
		# For files given above it will not display this metric
		isOldestFileAgeMetricRequired: true

		# If true then an extra metric will be shown that will give number of files in the directories specified above.
		# For files given above it will not display this metric
		isFileCountRequired: true

		# This is the global ignoreHiddenFiles flag. When an individual fileToProcess path has this flag missing, this global one will be used.   
		# If true then all the hidden files will be ignored monitoring.
		ignoreHiddenFiles: true

		numberOfThreads: 5



Metrics Provided
----------------

We provide following metric related to modification of a file.

- IsModified : 1 if file is modified in last minute and 0 if not.
- Size : A positive integer indicating the current size of the file.
- FileCount: Count of files in a directory.
- OldestFileAge: Time in seconds from current time to the oldest modified file of the directory


Configuration
-------------

###Note
Please make sure to not use tab (\t) while editing yaml files. You may want to validate the yaml file using a yaml validator http://yamllint.com/

1. Configure the file to be watched by editing the config.yaml file in `<MACHINE_AGENT_HOME>/monitors/FileWatcher/`. Refer to Sample config.yml above.


2. Configure the path to the config.yaml file by editing the <task-arguments> in the monitor.xml file. Below is the sample

     <task-arguments>
         <!-- config file-->
             <argument name="config-file" is-required="true" default-value="monitors/FileWatcher/config.yml" />
          ....
     </task-arguments>

Troubleshooting
---------------

1. Verify Machine Agent Data: Please start the Machine Agent without the extension and make sure that it reports data. Verify that the machine agent status is UP and it is reporting Hardware Metrics.
2. config.yml: Validate the file [here](http://www.yamllint.com/)
3. Collect Debug Logs: Edit the file, <MachineAgent>/conf/logging/log4j.xml and update the level of the appender com.appdynamics to debug Let it run for 5-10 minutes and attach the logs to a support ticket

Contributing
-------------

Always feel free to fork and contribute any changes directly via [GitHub][].

Community
----------

Find out more in the [Community][].

Support
--------

For any questions or feature request, please contact [AppDynamics Center of Excellence][].

**Version:** 1.2
**Controller Compatibility:** 3.7 or later

[GitHub]: https://github.com/Appdynamics/FileWatcher-extension
[Community]: http://community.appdynamics.com/
[AppDynamics Center of Excellence]: mailto:ace-request@appdynamics.com
